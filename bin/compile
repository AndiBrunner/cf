#!/usr/bin/env ruby
require "open-uri"

puts "__FILE__=#{__FILE__}"
#puts "File.expand_path("../../lib", __FILE__)=#{File.expand_path("../../lib", __FILE__)}"

#$:.unshift File.expand_path("../../lib", __FILE__)
#puts "2:$:=#{$:}"
$stdout.sync = true

build_dir = ARGV[0]
cache_dir = ARGV[1]
pwd=Dir.pwd

system("mkdir -p .profile.d")
system("echo export PATH=/home/vcap/app/nginx/sbin:\$PATH > #{pwd}/.profile.d/nginx.sh")
system("echo export PATH=/home/vcap/app/mono/bin:\$PATH > #{pwd}/.profile.d/mono.sh")

puts "build_dir=#{build_dir}"  
puts "cache_dir=#{cache_dir}" 
puts "pwd=#{Dir.pwd}"

Dir.chdir("#{build_dir}")
system("ls -al #{build_dir}")
system("ls -al #{build_dir}/www")


#download nginx
system("wget https://s3.amazonaws.com/accax/nginx-1.4.1-64.tar.bz2")
system("tar xjvf nginx-1.4.1-64.tar.bz2")
system("rm nginx-1.4.1-64.tar.bz2")
#download mono
system("wget https://s3.amazonaws.com/accax/mono-3.2.3-64.tar.bz2")
system("tar xjvf mono-3.2.3-64.tar.bz2")
system("rm mono-3.2.3-64.tar.bz2")

system("ls -al #{build_dir}/../")
system("ls -al #{build_dir}")




